<?php
declare(strict_types=1);
require_once dirname( __DIR__) . '/bootstrap.php';

if (!file_exists(__DIR__ . '/public-keys.json')) {
    die('key pairs not initialized');
}
if ($argc < 2) {
    die('Argument 1 is required (number)');
}
$para = (int) $argv[1];

$collider = new Collision32Bit();
$publicKeys = [];
$hexPublicKeys = json_decode(file_get_contents(__DIR__ . '/public-keys.json'), true);
foreach ($hexPublicKeys as $hex) {
    $publicKeys []= sodium_hex2bin($hex);
}

$result = $collider->findSeedCollisions($publicKeys, $para, false);

if (is_null($result)) {
    // Signal a failure to GNU Parallel so it doesn't eterminate
    exit(256);
}

echo 'FOUND IN ', $result->steps, ' STEPS!', PHP_EOL;
echo sodium_bin2hex($result->sk), PHP_EOL;
echo '  ->  ', PHP_EOL;
echo sodium_bin2hex($result->pk), PHP_EOL;
echo PHP_EOL;
echo 'SEE FOR YOURSELF IN key-pairs.json!', PHP_EOL, PHP_EOL;
